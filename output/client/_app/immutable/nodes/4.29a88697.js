import{S as ut,i as pt,s as ft,e as u,x as He,c as p,b as f,z as ze,g as r,o as s,h as j,A as Ve,v as Be,w as Ue,D as je,O as ht,Z as dt,a as v,t as O,y as gt,f as b,d as S,_ as lt,j as a,G as nt,B as Ne,$ as _t,k as vt,C as bt,E as Et,n as Tt}from"../chunks/index.0a40a80f.js";import{e as ot}from"../chunks/forms.1cb0d4cd.js";import{c as yt}from"../chunks/actions.c3a21eae.js";import{T as Ot}from"../chunks/toggle.c49ab143.js";import{i as St}from"../chunks/index-browser.d9ceecad.js";import{P as At}from"../chunks/Plot.bcfc853d.js";function Pt(l){let n,t,c;return t=new At({props:{data:l[2](l[1](l[0])),layout:{xaxis:{title:"Time"},yaxis:{title:"User Count"},showlegend:!1,margin:{t:20,r:0,b:80,l:50,pad:5},hovermode:"x unified",hoverdistance:-1},fillParent:"width",debounce:250}}),{c(){n=u("div"),He(t.$$.fragment),this.h()},l(o){n=p(o,"DIV",{class:!0});var h=f(n);ze(t.$$.fragment,h),h.forEach(r),this.h()},h(){s(n,"class","graph-container svelte-vo53i6")},m(o,h){j(o,n,h),Ve(t,n,null),c=!0},p(o,[h]){const y={};h&1&&(y.data=o[2](o[1](o[0]))),t.$set(y)},i(o){c||(Be(t.$$.fragment,o),c=!0)},o(o){Ue(t.$$.fragment,o),c=!1},d(o){o&&r(n),je(t)}}}function Ct(l,n,t){let{statusChanges:c}=n;const o=Object.keys(St.Status),h=new Map([["CREATED","lightgray"],["APPLIED","rgb(63, 63, 63)"],["ACCEPTED","rgb(93, 198, 93)"],["REJECTED","rgb(255, 78, 78)"],["WAITLISTED","orange"],["CONFIRMED","darkgreen"],["DECLINED","darkred"]]);function y(A){var P;const w=Object.fromEntries(o.map(C=>[C,[0]])),g=new Map;for(const C of o)g.set(C,new Set);for(let C of A){const{newStatus:L,userId:d}=C;o.forEach($=>{var D,J;(D=g.get($))!=null&&D.has(d)&&((J=g.get($))==null||J.delete(d))}),(P=g.get(L))==null||P.add(d),o.forEach($=>{var D;w[$].push(((D=g.get($))==null?void 0:D.size)??0)})}return w}function R(A){var C;const w=[(C=c[0])==null?void 0:C.timestamp,...c.map(L=>L.timestamp)],g=Object.keys(A).map(L=>({x:w,y:A[L],mode:"lines",name:L,line:{color:h.get(L)}})),P={x:w,y:w.map((L,d)=>Object.values(A).reduce(($,D)=>$+D[d],0)),mode:"lines",name:"TOTAL",line:{color:"#bf5700",width:4}};return g.push(P),g}return l.$$set=A=>{"statusChanges"in A&&t(0,c=A.statusChanges)},[c,y,R]}class Lt extends ut{constructor(n){super(),pt(this,n,Ct,Pt,ft,{statusChanges:0})}}function it(l,n,t){const c=l.slice();return c[3]=n[t],c}function rt(l){let n,t=l[3]+"",c;return{c(){n=u("option"),c=O(t),this.h()},l(o){n=p(o,"OPTION",{});var h=f(n);c=S(h,t),h.forEach(r),this.h()},h(){n.__value=l[3],n.value=n.__value},m(o,h){j(o,n,h),a(n,c)},p:Tt,d(o){o&&r(n)}}}function $t(l){let n,t,c,o,h,y,R,A,w,g,P,C,L,d,$,D,J,B,M,he,de,T,ie,Q,ge,F,Y,_e,ve,U,be,Z,x,Ee,Te,k,ee,ye,q,te,Oe,Se,N,re,Ae,G,ae,Pe,Ce,H,Me,Le,W,$e,ce,K,De,ue,z,V,ke,se=Object.values(l[0].decisions).reduce(ct,0)+"",pe,Ie,I,Re,Fe;function mt(e){l[2](e)}let Ze={name:"applicationOpen",label:"Accept new applications"};l[1]!==void 0&&(Ze.checked=l[1]),R=new Ot({props:Ze}),ht.push(()=>dt(R,"checked",mt,l[1])),U=new Lt({props:{statusChanges:l[0].graph}});let X=Intl.supportedValuesOf("timeZone"),E=[];for(let e=0;e<X.length;e+=1)E[e]=rt(it(l,X,e));return{c(){n=v(),t=u("form"),c=u("label"),o=u("h2"),h=O("Application Status"),y=v(),He(R.$$.fragment),w=v(),g=u("status-container"),P=u("label"),C=O("Hackers must apply before:"),L=v(),d=u("input"),J=v(),B=u("status-container"),M=u("label"),he=O(`Hackers can only apply if there are at most this number of accounts with status APPLIED,\r
			ACCEPTED, or CONFIRMED (leaving empty will disable this limit)`),de=v(),T=u("input"),ge=v(),F=u("label"),Y=u("h2"),_e=O("User Status Count Over Time"),ve=v(),He(U.$$.fragment),be=v(),Z=u("label"),x=u("h2"),Ee=O("Hackers have this many days after being accepted to RSVP (leave blank to disable RSVPs)"),Te=v(),k=u("input"),ye=v(),q=u("label"),te=u("h2"),Oe=O("Scan Options"),Se=v(),N=u("textarea"),Ae=v(),G=u("label"),ae=u("h2"),Pe=O("Timezone"),Ce=v(),H=u("select");for(let e=0;e<E.length;e+=1)E[e].c();Le=v(),W=u("button"),$e=O("Save"),ce=v(),K=u("h2"),De=O("Pending Decisions"),ue=v(),z=u("form"),V=u("button"),ke=O("Release all "),pe=O(se),Ie=O(` pending\r
		decisions`),this.h()},l(e){gt("svelte-1w9pveq",document.head).forEach(r),n=b(e),t=p(e,"FORM",{method:!0,action:!0,class:!0});var i=f(t);c=p(i,"LABEL",{for:!0,class:!0});var le=f(c);o=p(le,"H2",{});var ne=f(o);h=S(ne,"Application Status"),ne.forEach(r),le.forEach(r),y=b(i),ze(R.$$.fragment,i),w=b(i),g=p(i,"STATUS-CONTAINER",{class:!0});var _=f(g);P=p(_,"LABEL",{for:!0,class:!0});var oe=f(P);C=S(oe,"Hackers must apply before:"),oe.forEach(r),L=b(_),d=p(_,"INPUT",{type:!0,name:!0,id:!0,class:!0}),_.forEach(r),J=b(i),B=p(i,"STATUS-CONTAINER",{class:!0});var fe=f(B);M=p(fe,"LABEL",{for:!0,class:!0});var qe=f(M);he=S(qe,`Hackers can only apply if there are at most this number of accounts with status APPLIED,\r
			ACCEPTED, or CONFIRMED (leaving empty will disable this limit)`),qe.forEach(r),de=b(fe),T=p(fe,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,min:!0,class:!0}),fe.forEach(r),ge=b(i),F=p(i,"LABEL",{for:!0,class:!0});var Ge=f(F);Y=p(Ge,"H2",{});var We=f(Y);_e=S(We,"User Status Count Over Time"),We.forEach(r),Ge.forEach(r),ve=b(i),ze(U.$$.fragment,i),be=b(i),Z=p(i,"LABEL",{for:!0,class:!0});var Je=f(Z);x=p(Je,"H2",{});var Ke=f(x);Ee=S(Ke,"Hackers have this many days after being accepted to RSVP (leave blank to disable RSVPs)"),Ke.forEach(r),Je.forEach(r),Te=b(i),k=p(i,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0,min:!0,class:!0}),ye=b(i),q=p(i,"LABEL",{for:!0,class:!0});var Xe=f(q);te=p(Xe,"H2",{});var Qe=f(te);Oe=S(Qe,"Scan Options"),Qe.forEach(r),Xe.forEach(r),Se=b(i),N=p(i,"TEXTAREA",{name:!0,id:!0,placeholder:!0,class:!0}),f(N).forEach(r),Ae=b(i),G=p(i,"LABEL",{for:!0,class:!0});var Ye=f(G);ae=p(Ye,"H2",{});var xe=f(ae);Pe=S(xe,"Timezone"),xe.forEach(r),Ye.forEach(r),Ce=b(i),H=p(i,"SELECT",{name:!0,id:!0});var et=f(H);for(let we=0;we<E.length;we+=1)E[we].l(et);et.forEach(r),Le=b(i),W=p(i,"BUTTON",{type:!0,class:!0});var tt=f(W);$e=S(tt,"Save"),tt.forEach(r),i.forEach(r),ce=b(e),K=p(e,"H2",{});var at=f(K);De=S(at,"Pending Decisions"),at.forEach(r),ue=b(e),z=p(e,"FORM",{method:!0,action:!0,class:!0});var st=f(z);V=p(st,"BUTTON",{id:!0,class:!0});var me=f(V);ke=S(me,"Release all "),pe=S(me,se),Ie=S(me,` pending\r
		decisions`),me.forEach(r),st.forEach(r),this.h()},h(){var e;document.title="Formula Hacks | Admin - Admissions",s(c,"for","applicationStatus"),s(c,"class","svelte-3gg8b2"),s(P,"for","applicationDeadline"),s(P,"class","svelte-3gg8b2"),d.readOnly=$=!l[1],s(d,"type","datetime-local"),s(d,"name","applicationDeadline"),s(d,"id","applicationDeadline"),d.value=D=(e=l[0].settings.applicationDeadline)==null?void 0:e.toLocaleString("sv",{timeZone:l[0].settings.timezone}).replace(" ","T").slice(0,-3),s(d,"class","svelte-3gg8b2"),lt(g,"class","svelte-3gg8b2"),s(M,"for","applicationLimit"),s(M,"class","svelte-3gg8b2"),T.readOnly=ie=!l[1],s(T,"type","number"),s(T,"name","applicationLimit"),s(T,"id","applicationLimit"),T.value=Q=l[0].settings.applicationLimit,s(T,"placeholder","10000"),s(T,"min","0"),s(T,"class","svelte-3gg8b2"),lt(B,"class","svelte-3gg8b2"),s(F,"for","statusChangeText"),s(F,"class","svelte-3gg8b2"),s(Z,"for","daysToRSVP"),s(Z,"class","svelte-3gg8b2"),s(k,"type","number"),s(k,"id","daysToRSVP"),s(k,"name","daysToRSVP"),s(k,"placeholder","10"),s(k,"min","0"),k.value=ee=l[0].settings.daysToRSVP,s(k,"class","svelte-3gg8b2"),s(q,"for","scanActions"),s(q,"class","svelte-3gg8b2"),N.value=re=l[0].settings.scanActions.join(`
`),s(N,"name","scanActions"),s(N,"id","scanActions"),s(N,"placeholder","Write one option per line, like this:\rOPTION 1\rOPTION 2\rOPTION 3"),s(N,"class","svelte-3gg8b2"),s(G,"for","timezone"),s(G,"class","svelte-3gg8b2"),s(H,"name","timezone"),s(H,"id","timezone"),s(W,"type","submit"),s(W,"class","svelte-3gg8b2"),s(t,"method","POST"),s(t,"action","?/settings"),s(t,"class","svelte-3gg8b2"),s(V,"id","release"),s(V,"class","svelte-3gg8b2"),s(z,"method","POST"),s(z,"action","?/release"),s(z,"class","svelte-3gg8b2")},m(e,m){j(e,n,m),j(e,t,m),a(t,c),a(c,o),a(o,h),a(t,y),Ve(R,t,null),a(t,w),a(t,g),a(g,P),a(P,C),a(g,L),a(g,d),a(t,J),a(t,B),a(B,M),a(M,he),a(B,de),a(B,T),a(t,ge),a(t,F),a(F,Y),a(Y,_e),a(t,ve),Ve(U,t,null),a(t,be),a(t,Z),a(Z,x),a(x,Ee),a(t,Te),a(t,k),a(t,ye),a(t,q),a(q,te),a(te,Oe),a(t,Se),a(t,N),a(t,Ae),a(t,G),a(G,ae),a(ae,Pe),a(t,Ce),a(t,H);for(let i=0;i<E.length;i+=1)E[i].m(H,null);nt(H,l[0].settings.timezone),a(t,Le),a(t,W),a(W,$e),j(e,ce,m),j(e,K,m),a(K,De),j(e,ue,m),j(e,z,m),a(z,V),a(V,ke),a(V,pe),a(V,Ie),I=!0,Re||(Fe=[Ne(ot.call(null,t,Dt)),Ne(yt.call(null,V,{text:"Are you sure you want to release all pending decisions?",cancel:"Cancel",ok:"OK"})),Ne(ot.call(null,z))],Re=!0)},p(e,[m]){var ne;const i={};!A&&m&2&&(A=!0,i.checked=e[1],_t(()=>A=!1)),R.$set(i),(!I||m&2&&$!==($=!e[1]))&&(d.readOnly=$),(!I||m&1&&D!==(D=(ne=e[0].settings.applicationDeadline)==null?void 0:ne.toLocaleString("sv",{timeZone:e[0].settings.timezone}).replace(" ","T").slice(0,-3)))&&(d.value=D),(!I||m&2&&ie!==(ie=!e[1]))&&(T.readOnly=ie),(!I||m&1&&Q!==(Q=e[0].settings.applicationLimit)&&T.value!==Q)&&(T.value=Q);const le={};if(m&1&&(le.statusChanges=e[0].graph),U.$set(le),(!I||m&1&&ee!==(ee=e[0].settings.daysToRSVP)&&k.value!==ee)&&(k.value=ee),(!I||m&1&&re!==(re=e[0].settings.scanActions.join(`
`)))&&(N.value=re),m&0){X=Intl.supportedValuesOf("timeZone");let _;for(_=0;_<X.length;_+=1){const oe=it(e,X,_);E[_]?E[_].p(oe,m):(E[_]=rt(oe),E[_].c(),E[_].m(H,null))}for(;_<E.length;_+=1)E[_].d(1);E.length=X.length}(!I||m&1&&Me!==(Me=e[0].settings.timezone))&&nt(H,e[0].settings.timezone),(!I||m&1)&&se!==(se=Object.values(e[0].decisions).reduce(ct,0)+"")&&vt(pe,se)},i(e){I||(Be(R.$$.fragment,e),Be(U.$$.fragment,e),I=!0)},o(e){Ue(R.$$.fragment,e),Ue(U.$$.fragment,e),I=!1},d(e){e&&r(n),e&&r(t),je(R),je(U),bt(E,e),e&&r(ce),e&&r(K),e&&r(ue),e&&r(z),Re=!1,Et(Fe)}}}const Dt=()=>async({update:l})=>{l({reset:!1})},ct=(l,n)=>l+n.length;function kt(l,n,t){let{data:c}=n,o=c.settings.applicationOpen;function h(y){o=y,t(1,o)}return l.$$set=y=>{"data"in y&&t(0,c=y.data)},[c,o,h]}class Vt extends ut{constructor(n){super(),pt(this,n,kt,$t,ft,{data:0})}}export{Vt as component};
